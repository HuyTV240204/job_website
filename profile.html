<!-- cho dien thong tin nguoi dung -->
 <!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Hồ sơ ứng viên</title>
</head>
<body>
  <h2>Thông tin hồ sơ của bạn</h2>

  <form id="profileForm">
    <input type="text" id="fullName" placeholder="Họ và tên" required><br>
    <input type="text" id="position" placeholder="Vị trí mong muốn" required><br>
    <textarea id="skills" placeholder="Kỹ năng (VD: HTML, CSS, JS...)" required></textarea><br>
    <textarea id="experience" placeholder="Kinh nghiệm làm việc"></textarea><br>
    <textarea id="about" placeholder="Giới thiệu bản thân"></textarea><br>
    <button type="submit">💾 Lưu hồ sơ</button>
  </form>

  <button id="logoutBtn">🚪 Đăng xuất</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAqy3ZQVragF-GD6Cr8MCoq_KSywsrnKGQ",
      authDomain: "job-website-97920.firebaseapp.com",
      projectId: "job-website-97920",
      storageBucket: "job-website-97920.appspot.com",
      messagingSenderId: "107059239491",
      appId: "1:107059239491:web:228393f257176633c092f6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const profileForm = document.getElementById("profileForm");
    const logoutBtn = document.getElementById("logoutBtn");

    let currentUser = null;

    // Kiểm tra xem user đã đăng nhập chưa
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        alert("Vui lòng đăng nhập trước!");
        window.location.href = "login.html";
      } else {
        currentUser = user;

        // Tự động lấy thông tin hồ sơ đã lưu (nếu có)
        const docRef = doc(db, "applicants", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById("fullName").value = data.fullName || "";
          document.getElementById("position").value = data.position || "";
          document.getElementById("skills").value = data.skills || "";
          document.getElementById("experience").value = data.experience || "";
          document.getElementById("about").value = data.about || "";
        }
      }
    });

    // Lưu thông tin hồ sơ
    profileForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!currentUser) return alert("Bạn chưa đăng nhập!");

      const data = {
        fullName: document.getElementById("fullName").value,
        position: document.getElementById("position").value,
        skills: document.getElementById("skills").value,
        experience: document.getElementById("experience").value,
        about: document.getElementById("about").value,
        updatedAt: new Date()
      };

      await setDoc(doc(db, "applicants", currentUser.uid), data, { merge: true });
      alert("✅ Hồ sơ đã được lưu!");
    });

    // Đăng xuất
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
<!-- Khi người dùng đăng nhập xong, họ vào profile.html
→ Có thể nhập thông tin hồ sơ cá nhân (giống CV)
→ Khi nhấn Lưu hồ sơ, dữ liệu được lưu vào Firestore collection applicants -->
